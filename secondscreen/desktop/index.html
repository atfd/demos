<!DOCTYPE html>
<html lang="en">
		
	<link href="../styles/desktop.css" rel="stylesheet" type="text/css" />

	<body>

		<div class="demo">

	   		<div id="info"><a href="https://youtu.be/kLZJ-0IP9bY" target="_blank">Video</a> by <a href="http://www.knowermusic.com/" target="_blank">Knower</a></div>
            <div id="player"></div>
            <div id="disconnected">
                <p>When asked for it, use this unique id to connect the other device:</p>
                <h2 id="handshakeID"></h2>
            </div>

            <div id="connected">You're connected!</div>
            
	    </div>
	    
	   	<div class="description">
            <p>A second screen demo, implemented in node.js.</p>
            <div class="links">
                <a href="//github.com/artofrawr/demos/tree/master/secondscreen" target="_blank">Source on GitHub</a>
                <a href="/">Home</a>
            </div>
        </div>


        <script src="EventDispatcher.js"></script>
		<script src="script.js"></script>

		<script type="text/javascript">
			
			// ---------------------------------------------------
            // The actual demo class from script.js
            // ---------------------------------------------------
			var demo = new SecondScreenDemo();

			demo.addEventListener('message', function (e) {
                switch (e.data.type) {

                    case "play":
                        if (e.data.value == true) {
                            player.playVideo();
                        } else {
                            player.pauseVideo();
                        }
                        break;

                    case "bassline":
                        player.seekTo(33);
                        player.playVideo();
                        break;
                }

            }, false);

            // ---------------------------------------------------
            // Youtube Player 
            // ---------------------------------------------------
            var video_id = 'kLZJ-0IP9bY';
			var isPlaying = true;
			var volume  = 1;
			var fullscreen  = false;
			var player;
            var progressTimer;

            function onYouTubeIframeAPIReady() {
                player = new YT.Player('player', {
                    height: '390',
                    width: '640',
                    videoId: video_id,
                    playerVars: { 'controls': 0 },
                    events: {
                        'onReady': function() { player.playVideo(); },
                        'onStateChange': onPlayerStateChange
	                }               
	            });
	        }

            function onPlayerStateChange ( event ) {
                if ( event.data == YT.PlayerState.PLAYING ) {
                    if (progressTimer) clearTimeout(progressTimer);
                    progressTimer = setInterval(function() {
                        demo.sendMessage({type:"time", value: player.getCurrentTime()});
                    }, 1000);        
                } else {
                    if (progressTimer) clearTimeout(progressTimer);
                }

                if ( event.data == YT.PlayerState.ENDED ) {
                    player.playVideo();
                }
            }

            // ---------------------------------------------------
            // start the youtube API loading to activate videos
            // ---------------------------------------------------

            var tag = document.createElement('script');
            tag.src = "//www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


		</script>

	</body>

</html>
